---
sidebar: sidebar 
permalink: trident-use/vol-clone-cross-namespace.html 
keywords: volref, volume reference, clone, pvc, pv, namespace, cvna, cross-namespace, sharing, volumesnapshots 
summary: 'Avec Trident, vous pouvez créer de nouveaux volumes à partir de volumes existants ou d"instantanés de volumes provenant d"un espace de noms différent au sein du même cluster K8s.' 
---
= Cloner des volumes entre espaces de noms
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Avec Trident, vous pouvez créer de nouveaux volumes à partir de volumes existants ou d'instantanés de volumes provenant d'un espace de noms différent au sein du même cluster Kubernetes.



== Prérequis

Avant de cloner des volumes, assurez-vous que les systèmes de stockage source et de destination sont du même type et ont la même classe de stockage.


NOTE: Le clonage entre espaces de noms est pris en charge uniquement pour le `ontap-san` et `ontap-nas` pilotes de stockage. Les clones en lecture seule ne sont pas pris en charge.



== Démarrage rapide

Vous pouvez configurer le clonage de volumes en quelques étapes seulement.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["Un"]Configurez le PVC source pour cloner le volume.
[role="quick-margin-para"]
Le propriétaire de l'espace de noms source accorde l'autorisation d'accéder aux données du PVC source.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["Deux"]Autoriser la création d'une demande de changement dans l'espace de noms de destination
[role="quick-margin-para"]
L'administrateur du cluster autorise le propriétaire de l'espace de noms de destination à créer la ressource personnalisée TridentVolumeReference.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["Trois"]Créez une référence de volume Trident dans l'espace de noms de destination.
[role="quick-margin-para"]
Le propriétaire de l'espace de noms de destination crée la ressource personnalisée TridentVolumeReference pour faire référence au volume persistant source.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png["Quatre"]Créez le PVC cloné dans l'espace de noms de destination
[role="quick-margin-para"]
Le propriétaire de l'espace de noms de destination crée un PVC pour cloner le PVC de l'espace de noms source.



== Configurez les espaces de noms source et de destination

Pour garantir la sécurité, le clonage de volumes entre espaces de noms nécessite la collaboration et l'action du propriétaire de l'espace de noms source, de l'administrateur du cluster et du propriétaire de l'espace de noms de destination.  Le rôle de l'utilisateur est défini à chaque étape.

.Étapes
. *Propriétaire de l'espace de noms source :* Créer le PVC(`pvc1` ) dans l'espace de noms source(`namespace1` ) qui autorise le partage avec l'espace de noms de destination(`namespace2` ) en utilisant `cloneToNamespace` annotation.
+
[source, yaml]
----
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: pvc1
  namespace: namespace1
  annotations:
    trident.netapp.io/cloneToNamespace: namespace2
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: trident-csi
  resources:
    requests:
      storage: 100Gi
----
+
Trident crée le PV et son volume de stockage backend.

+
[NOTE]
====
** Vous pouvez partager le PVC avec plusieurs espaces de noms en utilisant une liste séparée par des virgules.  Par exemple, `trident.netapp.io/cloneToNamespace: namespace2,namespace3,namespace4` .
** Vous pouvez partager avec tous les espaces de noms en utilisant `*` .  Par exemple, `trident.netapp.io/cloneToNamespace: *`
** Vous pouvez mettre à jour le PVC pour inclure le `cloneToNamespace` annotation à tout moment.


====
. *Administrateur du cluster :* Assurez-vous que le contrôle d'accès basé sur les rôles (RBAC) est correctement configuré pour autoriser le propriétaire de l'espace de noms de destination à créer la ressource personnalisée TridentVolumeReference dans l'espace de noms de destination.(`namespace2` ).
. *Propriétaire de l'espace de noms de destination :* Créez une ressource personnalisée TridentVolumeReference dans l'espace de noms de destination qui fait référence à l'espace de noms source. `pvc1` .
+
[source, yaml]
----
apiVersion: trident.netapp.io/v1
kind: TridentVolumeReference
metadata:
  name: my-first-tvr
  namespace: namespace2
spec:
  pvcName: pvc1
  pvcNamespace: namespace1
----
. *Propriétaire de l'espace de noms de destination :* Créer un PVC(`pvc2` ) dans l'espace de noms de destination(`namespace2` ) en utilisant `cloneFromPVC` ou `cloneFromSnapshot` , et `cloneFromNamespace` annotations pour désigner le PVC source.
+
[source, yaml]
----
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  annotations:
    trident.netapp.io/cloneFromPVC: pvc1
    trident.netapp.io/cloneFromNamespace: namespace1
  name: pvc2
  namespace: namespace2
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: trident-csi
  resources:
    requests:
      storage: 100Gi
----




== Limites

* Pour les PVC provisionnés à l'aide des pilotes ontap-nas-economy, les clones en lecture seule ne sont pas pris en charge.

